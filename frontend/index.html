<!-- Dashboard -->
<!-- Consumer Payment Gateway -->

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">

		<script src="https://kit.fontawesome.com/4467197cc4.js"></script>
		<link href="https://fonts.googleapis.com/css?family=Karla:400,700&display=swap&subset=latin-ext" rel="stylesheet">
		<link rel="stylesheet" href="styles.css">

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<script src="PapaParse-5.0.0/papaparse.js"></script>
		<script src="https://www.gstatic.com/firebasejs/6.2.4/firebase-app.js"></script>
		<script src="app.js"></script>

        <title>Dashboard | CXA 2019</title>
    </head>

    <body>
		<div id="header">
			<p id="logo">Data<span>Drive</span></p>
			<div id="nav">
				<p style="color: #2f3542;font-weight: bold;" id="dashboard-page" onclick="window.location='index.html'">Dashboard</p>
				<!-- <p id="marketplace-page" onclick="window.location='marketplace.html'">Marketplace</p> -->
				<p id="resource-map-page" onclick="window.location='resources.html'">Resources</p>
			</div>
			<div id="user">
				<p><i class="fas fa-user"></i>John Doe</p>
			</div>
		</div>

		<div id="infobar"></div>

		<div id="dashboard">
			<div id="analytics">
				<div id="analytics-header">
					<p id="analytics-title">At a glance</p>
				</div>
				<div id="analytics-db">
					<div class="adb-card" id="total-payments">
						<p class="adb-card-icon"><i class="fas fa-receipt"></i></p>
						<p class="adb-card-metric"><span style="font-size: 18px;color: #27282b;padding-right:5px;">$</span>2.12k</p>
						<p class="adb-card-desc"><i style="color: #1dd1a1;padding-right: 10px;font-size: 22px;" class="fas fa-caret-up"></i> Total Payments</p>
					</div>

					<div class="adb-card" id="sales">
						<p class="adb-card-icon"><i class="fas fa-cash-register"></i></p>
						<p class="adb-card-metric"><span style="font-size: 18px;color: #27282b;padding-right:5px;">$</span>3.56k</p>
						<p class="adb-card-desc"><i style="color: #1dd1a1;padding-right: 10px;font-size: 22px;" class="fas fa-caret-up"></i> Sales Volume</p>
					</div>

					<div class="adb-card" id="mrr">
						<p class="adb-card-icon"><i class="fas fa-funnel-dollar"></i></p>
						<p class="adb-card-metric"><span style="font-size: 18px;color: #27282b;padding-right:5px;">$</span>12.5k</p>
						<p class="adb-card-desc"><i style="color: #ff6b6b;padding-right: 10px;font-size: 22px;" class="fas fa-caret-down"></i> Recurring Revenue</p>
					</div>

					<div class="adb-card" id="inv">
						<p class="adb-card-icon"><i class="fas fa-dolly-flatbed"></i></p>
						<p class="adb-card-metric">67.8<span style="padding-left:5px;font-size: 18px;color: #27282b;">%</span></p>
						<p class="adb-card-desc"><i style="color: #1dd1a1;padding-right: 10px;font-size: 22px;" class="fas fa-caret-up"></i> Inventory</p>
					</div>
				</div>
			</div>

			<div id="inventory">
				<div id="inventory-header">
					<p id="inv-title">From your Inventory</p>
					<button id="inv-upload">Upload CSV</button>
					<input type="file" style="display: none;" id="inv-file">
				</div>
				<div id="inv-db">
					<div id="spreadsheet-top">
						<div class="ss-header">
							<p>Product Name</p>
						</div>
						<div class="ss-header">
							<p>Current Stock</p>
						</div>
						<div class="ss-header">
							<p>Threshold</p>
						</div>
						<div class="ss-header">
							<p>Status</p>
						</div>
					</div>
					<div id="spreadsheet-cells">
						<!-- <div class="ss-row">
							<div class="cell">
								<p class="cell-title">Coke</p>
							</div>
							<div class="cell">
								<p class="cell-title">300</p>
							</div>
							<div class="cell">
								<p class="cell-title">250</p>
							</div>
						</div>

						<div class="ss-row">
							<div class="cell">
								<p class="cell-title">Coke</p>
							</div>
							<div class="cell">
								<p class="cell-title">300</p>
							</div>
							<div class="cell">
								<p class="cell-title">250</p>
							</div>
						</div>

						<div class="ss-row">
							<div class="cell">
								<p class="cell-title">Coke</p>
							</div>
							<div class="cell">
								<p class="cell-title">300</p>
							</div>
							<div class="cell">
								<p class="cell-title">250</p>
							</div> -->
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
	
	<script>
		document.addEventListener('DOMContentLoaded', function() {
			var firebaseConfig = {
				apiKey: "AIzaSyBY8H2AtuzMXVX7IevYyn0Wr8PdiYaIrGU",
				authDomain: "test-a1287.firebaseapp.com",
				databaseURL: "https://test-a1287.firebaseio.com",
				projectId: "test-a1287",
				storageBucket: "test-a1287.appspot.com",
				messagingSenderId: "494992214705",
				appId: "1:494992214705:web:38a77d4c9514b154"
			};
			firebase.initializeApp(firebaseConfig);

			const CSVupload = document.getElementById('inv-upload');
			const fileBtn = document.getElementById('inv-file');

			const spreadsheetContent = document.getElementById('spreadsheet-cells')

			function uploadInv() {
				var db = firebase.database.ref()
				db.child('Inventory').on('value', (snapshot) => {
					snapshot.forEach(element => {
						var row = document.createElement('div')
						row.classList += 'ss-row'

						element.forEach(cell => {
							var newCell = document.createElement('ss-cell')
							var newCellTitle = document.createElement('p')
							newCell.classList += 'cell'
							newCellTitle.innerText = cell.val()
							newCellTitle.classList += 'cell-title'
							newCell.appendChild(newCellTitle)
							row.appendChild(newCell)
						});

						if (element[1] < element[2]) {
							var statusCell = document.createElement('div')
							statusCell.classList += 'cell'
							var status = document.createElement('div')
							status.classList += 'cell-status'
							status.style.backgroundColor = '#ff6b6b'
							statusCell.appendChild(status)
							row.appendChild(statusCell)
						} else {
							var statusCell = document.createElement('div')
							statusCell.classList += 'cell'
							var status = document.createElement('div')
							status.classList += 'cell-status'
							status.style.backgroundColor = '#1dd1a1'
							statusCell.appendChild(status)
							row.appendChild(statusCell)
						}

						spreadsheetContent.appendChild(row)
					});
				})
			}

			uploadInv()

			function handleFile() {
				const fileList = this.files;
				Papa.parse(fileList[0], {
					complete: function(res) {
						var data = res.data
						data = data.splice(1)

						// Send to Firebase if new one is chosen

						data.forEach(element => {
							var row = document.createElement('div')
							row.classList += 'ss-row'

							element.forEach(cell => {
								var newCell = document.createElement('ss-cell')
								var newCellTitle = document.createElement('p')
								newCell.classList += 'cell'
								newCellTitle.innerText = cell
								newCellTitle.classList += 'cell-title'
								newCell.appendChild(newCellTitle)
								row.appendChild(newCell)
							});

							if (element[1] < element[2]) {
								var statusCell = document.createElement('div')
								statusCell.classList += 'cell'
								var status = document.createElement('div')
								status.classList += 'cell-status'
								status.style.backgroundColor = '#ff6b6b'
								statusCell.appendChild(status)
								row.appendChild(statusCell)
							} else {
								var statusCell = document.createElement('div')
								statusCell.classList += 'cell'
								var status = document.createElement('div')
								status.classList += 'cell-status'
								status.style.backgroundColor = '#1dd1a1'
								statusCell.appendChild(status)
								row.appendChild(statusCell)
							}

							spreadsheetContent.appendChild(row)
						});
					}
				})
			}

			CSVupload.addEventListener('click', () => {
				fileBtn.click();
				fileBtn.addEventListener('change', handleFile, false);
			})
		})
	</script>
</html>